from pathlib import Path
path = Path('server.js')
text = path.read_text()
old = "        const verification = await fetch(\"https://www.google.com/recaptcha/api/siteverify\", {\r\n            method: \"POST\",\r\n            headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\r\n            body: new URLSearchParams({\r\n                secret: process.env.RECAPTCHA_SECRET,\r\n                response: recaptcha\r\n            })\r\n        });\r\n        const verificationResult = await verification.json();\r\n\r\n        if (!verificationResult.success) {\r\n            return res.status(400).json({ success: false, message: \"No pudimos verificar que seas humano.\" });\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Error verificando reCAPTCHA\", error);\r\n        return res.status(500).json({ success: false, message: \"Fallo la verificaci?n de seguridad.\" });\r\n    }\r\n\r\n    try {\r\n"
new = "        const verification = await fetch(\"https://www.google.com/recaptcha/api/siteverify\", {\r\n            method: \"POST\",\r\n            headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\r\n            body: new URLSearchParams({\r\n                secret: process.env.RECAPTCHA_SECRET,\r\n                response: recaptcha\r\n            })\r\n        });\r\n        const verificationResult = await verification.json();\r\n        console.log(\"reCAPTCHA verification result:\", verificationResult);\r\n\r\n        if (!verificationResult.success) {\r\n            const errorCodes = verificationResult[\"error-codes\"] || [];\r\n            console.warn(\"reCAPTCHA verification failed:\", errorCodes);\r\n\r\n            return res.status(400).json({\r\n                success: false,\r\n                message: errorCodes.includes(\"invalid-input-secret\") || errorCodes.includes(\"invalid-input-response\")\r\n                    ? \"Configuracion de reCAPTCHA invalida. Revisa la llave del sitio y el secret.\"\r\n                    : \"No pudimos verificar que seas humano.\",\r\n                errors: errorCodes\r\n            });\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Error verificando reCAPTCHA\", error);\r\n        return res.status(500).json({ success: false, message: \"Fallo la verificaci?n de seguridad.\" });\r\n    }\r\n\r\n    try {\r\n"
if old not in text:
    raise SystemExit('Original snippet not found')
path.write_text(text.replace(old, new, 1))
